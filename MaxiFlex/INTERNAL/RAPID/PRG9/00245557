MODULE MachineData

    CONST num MAX_DATA_SIZE:=12;

    VAR string mData{MAX_DATA_SIZE};
    VAR string serial;
    VAR string version;
    VAR string rtype;
    VAR string cid;
    VAR string lanip;
    VAR string clang;
    VAR string dutyTime;
    VAR string machineName;
    VAR string projectNumber;
    VAR string dateOfCreation;
    VAR string dateOfFAT;
    VAR string dateOfSOP;
	
	VAR bool isSending;

    PROC main()
        serial:=GetSysInfo(\SerialNo);
        version:=GetSysInfo(\SWVersion);
        rtype:=GetSysInfo(\RobotType);
        cid:=GetSysInfo(\CtrlId);
        lanip:=GetSysInfo(\LanIp);
        clang:=GetSysInfo(\CtrlLang);
        dutyTime:=GetServiceInfo(ROB_1\DutyTimeCnt);
        machineName:="Multiflex";
        projectNumber:="20184";
        dateOfCreation:="2015";
        dateOfFAT:="31.08.15";
        dateOfSOP:="10.10.15";
		
		isSending := TRUE;

        mData:=[machineName,projectNumber,dateOfCreation,dateOfFAT,dateOfSOP,serial,version,rtype,cid,lanip,clang,dutyTime];
        WHILE isSending DO
            IF clientConnected THEN					
                    FOR i FROM 1 TO MAX_DATA_SIZE DO
                        tpWriteSocket mData{i},":"+ValToStr(i-1)+":";
                    ENDFOR
                clientConnected:=FALSE;   
				isSending:=FALSE;				
            ENDIF
        ENDWHILE
		WaitTime 5;
    ENDPROC
ENDMODULE